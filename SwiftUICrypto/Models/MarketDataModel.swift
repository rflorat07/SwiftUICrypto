//
//  MarketDataModel.swift
//  SwiftUICrypto
//
//  Created by Roger Florat Gutierrez on 27/08/25.
//

import Foundation

/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 
 {
     "data": {
         "active_cryptocurrencies": 18438,
         "upcoming_icos": 0,
         "ongoing_icos": 49,
         "ended_icos": 3376,
         "markets": 1353,
         "total_market_cap": {
             "btc": 35327612.64404404,
             "eth": 867419219.9811276,
             "ltc": 34999559747.78878,
             "bch": 7125418724.333718,
             "bnb": 4602072146.736561,
             "eos": 7948182205777.002,
             "xrp": 1319842055148.2397,
             "xlm": 10366901971252.492,
             "link": 164484429444.29852,
             "dot": 1025978022161.2532,
             "yfi": 724247759.2471769,
             "sol": 19334765550.38142,
             "usd": 3952214465038.6914,
             "aed": 14516088508640.613,
             "ars": 5339462238451489,
             "aud": 6073277067492.264,
             "bdt": 480907997379808.94,
             "bhd": 1489992757748.5173,
             "bmd": 3952214465038.6914,
             "brl": 21417445407491.18,
             "cad": 5448906226305.45,
             "chf": 3171766722413.0376,
             "clp": 3828273019415079.5,
             "cny": 28274142282886.812,
             "czk": 83326003837977.28,
             "dkk": 25362130903973.98,
             "eur": 3397406550651.0264,
             "gbp": 2928405164513.8145,
             "gel": 10631456910954.084,
             "hkd": 30771348992621.508,
             "huf": 1348079403335819,
             "idr": 64669290592000150,
             "ils": 13157317175560.312,
             "inr": 346385295873376.56,
             "jpy": 582941753057044.6,
             "krw": 5504580032042045,
             "kwd": 1207859975947.2651,
             "lkr": 1194132808729063.2,
             "mmk": 8295698162116217,
             "mxn": 73753558601788.2,
             "myr": 16735652152206.344,
             "ngn": 6074000322739363,
             "nok": 39853656399714.375,
             "nzd": 6745821450793.433,
             "php": 225884893200322.72,
             "pkr": 1113931646971155.4,
             "pln": 14498951706720.207,
             "rub": 317560574545579.75,
             "sar": 14829617682152.133,
             "sek": 37678120425289.164,
             "sgd": 5081516274064.384,
             "thb": 128028035380463.39,
             "try": 162186637684775.28,
             "twd": 120734223585234.5,
             "uah": 163206767473633.2,
             "vef": 395735234384.324,
             "vnd": 104252565024861660,
             "zar": 69912488311935.29,
             "xdr": 2770707855144.3057,
             "xag": 102636005974.06142,
             "xau": 1164045726.387846,
             "bits": 35327612644044.04,
             "sats": 3532761264404404
         },
         "total_volume": {
             "btc": 1252287.5486562864,
             "eth": 30748137.42984835,
             "ltc": 1240658782.189092,
             "bch": 252580700.4666033,
             "bnb": 163133515.57164216,
             "eos": 281745888436.76263,
             "xrp": 46785549550.39446,
             "xlm": 367484278871.26215,
             "link": 5830617681.878806,
             "dot": 36368704426.568474,
             "yfi": 25673018.445540585,
             "sol": 685375669.1371907,
             "usd": 140097464667.53207,
             "aed": 514563977977.37866,
             "ars": 189272401311287.62,
             "aud": 215284551712.90927,
             "bdt": 17047149583415.08,
             "bhd": 52817024374.58895,
             "bmd": 140097464667.53207,
             "brl": 759202170779.8234,
             "cad": 193151954244.7325,
             "chf": 112432278222.16989,
             "clp": 135704008175558.33,
             "cny": 1002257262231.5249,
             "czk": 2953726823744.971,
             "dkk": 899032749777.164,
             "eur": 120430722674.96864,
             "gbp": 103805636737.80193,
             "gel": 376862179955.66144,
             "hkd": 1090777845281.705,
             "huf": 47786502541435,
             "idr": 2292386643976925.5,
             "ils": 466398469624.6812,
             "inr": 12278610429481.828,
             "jpy": 20664025794799.32,
             "krw": 195125470383870.78,
             "kwd": 42816026761.8325,
             "lkr": 42329428339264.73,
             "mmk": 294064578337149.94,
             "mxn": 2614404319836.8345,
             "myr": 593242714134.6647,
             "ngn": 215310189548943.3,
             "nok": 1412726022011.6338,
             "nzd": 239124797177.91855,
             "php": 8007131476290.384,
             "pkr": 39486470416543.92,
             "pln": 513956515370.58026,
             "rub": 11256836329544.936,
             "sar": 525677909849.454,
             "sek": 1335607971610.7437,
             "sgd": 180128774124.16806,
             "thb": 4538317270440.035,
             "try": 5749165928009.979,
             "twd": 4279767399396.105,
             "uah": 5785327325200.103,
             "vef": 14027959137.15998,
             "vnd": 3695528209379994,
             "zar": 2478246676070.6816,
             "xdr": 98215607800.10274,
             "xag": 3638224683.3426614,
             "xau": 41262906.26852823,
             "bits": 1252287548656.2864,
             "sats": 125228754865628.64
         },
         "market_cap_percentage": {
             "btc": 56.36501736088039,
             "eth": 13.905189326717554,
             "xrp": 4.51240744685065,
             "usdt": 4.2362674913113185,
             "bnb": 3.0319494585572175,
             "sol": 2.8005471630910534,
             "usdc": 1.7536211830989252,
             "steth": 1.005604527526761,
             "doge": 0.8382142651088862,
             "trx": 0.8317466405033971
         },
         "market_cap_change_percentage_24h_usd": 0.16841270307857822,
         "updated_at": 1756325755
     }
 }
 
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: {$0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volumen: String {
        if let item = totalVolume.first(where: {$0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        
        return ""
    }
    
    var btcDominance: String {
       if let item = marketCapPercentage.first(where: {$0.key == "btc"}) {
           return item.value.asPercentString()
        }
        
        return ""
    }
}

